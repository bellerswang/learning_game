<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>May's Shape Detective</title>
    <!-- Confetti for victory -->
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #FFF5E6;
            --text-color: #2D3436;
            --accent-purple: #6C5CE7;
            --accent-mint: #00B894;
            --border-color: #333;
            --font-main: 'Comic Sans MS', 'Lexend', sans-serif;
        }

        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            padding: 0;
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        header {
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid var(--border-color);
            background: white;
            z-index: 10;
        }

        h1 {
            margin: 0;
            font-size: 1.5rem;
        }

        #reset-btn {
            background-color: var(--accent-purple);
            color: white;
            border: 3px solid var(--border-color);
            padding: 0.5rem 1rem;
            font-family: inherit;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            border-radius: 8px;
            transition: transform 0.1s;
        }

        #reset-btn:active {
            transform: scale(0.95);
        }

        .main-container {
            display: grid;
            grid-template-columns: 1fr;
            grid-template-rows: 60% 40%;
            height: calc(100vh - 70px);
            /* Minus header approx */
            position: relative;
        }

        @media (min-width: 768px) {
            .main-container {
                grid-template-columns: 70% 30%;
                grid-template-rows: 1fr;
            }
        }

        /* ZONE A: The Room */
        #zone-scene {
            position: relative;
            background-color: #e0f7fa;
            /* Pastel placeholder */
            background-image: radial-gradient(#ffe0b2 20%, transparent 20%),
                radial-gradient(#ffe0b2 20%, transparent 20%);
            background-size: 50px 50px;
            background-position: 0 0, 25px 25px;
            overflow: hidden;
            border-bottom: 3px solid var(--border-color);
        }

        @media (min-width: 768px) {
            #zone-scene {
                border-bottom: none;
                border-right: 3px solid var(--border-color);
            }
        }

        .shape-item {
            position: absolute;
            font-size: 4rem;
            cursor: pointer;
            user-select: none;
            transition: transform 0.2s, opacity 0.3s;
            /* Hit target sizing if necessary, font size covers most */
        }

        .shape-item:hover {
            transform: scale(1.1);
        }

        .shape-item.found {
            pointer-events: none;
        }

        /* ZONE B: The Clipboard */
        #zone-tally {
            background-color: white;
            padding: 1rem;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
        }

        .clipboard-title {
            text-align: center;
            text-decoration: underline;
            margin-bottom: 1rem;
        }

        #target-display {
            background: #ffecb3;
            padding: 0.5rem;
            border: 2px dashed var(--border-color);
            margin-bottom: 1rem;
            font-size: 0.9rem;
            text-align: center;
        }

        table.tally-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 1.2rem;
        }

        th,
        td {
            border: 3px solid var(--border-color);
            padding: 0.5rem;
            text-align: center;
        }

        th {
            background-color: var(--accent-mint);
        }

        /* Tally Marks Visualization */
        .tally-marks {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            min-height: 40px;
        }

        .tally-group {
            display: inline-block;
            position: relative;
            width: 30px;
            height: 30px;
        }

        .tally-line {
            position: absolute;
            background-color: black;
            width: 4px;
            /* Thick lines requested */
            height: 100%;
            border-radius: 2px;
        }

        .line-1 {
            left: 2px;
        }

        .line-2 {
            left: 8px;
        }

        .line-3 {
            left: 14px;
        }

        .line-4 {
            left: 20px;
        }

        .line-5 {
            left: 0;
            top: 45%;
            height: 4px;
            width: 120%;
            transform: rotate(-45deg);
            transform-origin: center;
        }

        /* Modal */
        #win-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 100;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s;
        }

        #win-modal.visible {
            opacity: 1;
            pointer-events: auto;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border: 3px solid var(--border-color);
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 10px 0 rgba(0, 0, 0, 0.2);
            max-width: 90%;
        }

        .modal-content h2 {
            color: var(--accent-purple);
            font-size: 2rem;
        }

        .play-again-btn {
            font-size: 1.5rem;
            padding: 0.5rem 1.5rem;
            background: var(--accent-mint);
            border: 3px solid var(--border-color);
            color: black;
            cursor: pointer;
            border-radius: 10px;
            margin-top: 1rem;
        }
    </style>
</head>

<body>

    <header>
        <h1>May's Shape Detective</h1>
        <button id="reset-btn">Reset</button>
    </header>

    <div class="main-container">
        <!-- Zone A -->
        <div id="zone-scene">
            <!-- Shapes will be injected here -->
        </div>

        <!-- Zone B -->
        <div id="zone-tally">
            <h2 class="clipboard-title">Tally Chart</h2>
            <div id="target-display">Mission: Loading...</div>
            <table class="tally-table">
                <thead>
                    <tr>
                        <th style="width: 20%">Shape</th>
                        <th style="width: 60%">Tally</th>
                        <th style="width: 20%">Total</th>
                    </tr>
                </thead>
                <tbody id="tally-body">
                    <!-- Rows injected via JS -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- Win Modal -->
    <div id="win-modal">
        <div class="modal-content">
            <h2>Well Done, May! ðŸŽ‰</h2>
            <p>You found all the shapes!</p>
            <button class="play-again-btn" onclick="resetGame()">Play Again</button>
        </div>
    </div>

    <script>
        // --- Data & Config ---
        // The display icon for the category (Tally Chart)
        const SHAPE_TYPES = [
            { id: 'square', emoji: 'ðŸŸ§', name: 'Square' },
            { id: 'rectangle', emoji: 'ðŸ«', name: 'Rectangle' },
            { id: 'circle', emoji: 'ðŸª', name: 'Circle' },
            { id: 'triangle', emoji: 'ðŸ•', name: 'Triangle' },
            { id: 'sphere', emoji: 'âš½', name: 'Sphere' },
            { id: 'cone', emoji: 'ðŸ¦', name: 'Cone' },
            { id: 'cube', emoji: 'ðŸ§Š', name: 'Cube' },
            { id: 'cylinder', emoji: 'ðŸ¥«', name: 'Cylinder' }
        ];

        // 200+ Variants Pool
        const SHAPE_VARIANTS = {
            square: [
                'ðŸŸ§', 'ðŸŸ¦', 'ðŸŸª', 'ðŸŸ«', 'â¬›', 'â¬œ', 'ðŸŸ¥', 'ðŸŸ¨', 'ðŸ”³', 'ðŸ”²', 'ðŸ–¼ï¸', 'ðŸ’¾', 'ðŸ“˜', 'ðŸ“•', 'ðŸ““', 'ðŸ“”', 'ðŸ“’', 'ðŸ§‡', 'ðŸ§¼', 'ðŸ—³ï¸', 'ðŸ—ƒï¸', 'ðŸ’Ÿ', 'â¹ï¸', 'â„¹ï¸', 'ðŸ†”', 'ðŸˆ¯', 'ðŸ’¹', 'â‡ï¸', 'ðŸ†™', 'ðŸ†š', 'ðŸ†•', 'ðŸ…¿ï¸', 'ðŸ†Ž', 'ðŸ†‘', 'ðŸ†’', 'ðŸ†“', 'ðŸ†”', 'ðŸˆ', 'ðŸˆ‚ï¸', 'ðŸˆ·ï¸', 'ðŸˆ¶', 'ðŸˆ¯', 'ðŸ‰', 'ðŸˆ¹', 'ðŸˆš', 'ðŸˆ²', 'ðŸ‰‘', 'ðŸˆ¸', 'ðŸˆ´', 'ðŸˆ³', 'ðŸˆº', 'ðŸˆµ'
            ],
            rectangle: [
                'ðŸ«', 'ðŸ“±', 'ðŸ“²', 'ðŸ§±', 'ðŸ“–', 'ðŸ“—', 'ðŸ“™', 'ðŸ’µ', 'ðŸ’´', 'ðŸ’¶', 'ðŸ’·', 'ðŸŽ«', 'ðŸ·ï¸', 'ðŸšª', 'ðŸªŸ', 'ðŸ“º', 'ðŸ’»', 'âŒ¨ï¸', 'ðŸ’³', 'ðŸ“', 'âœ‰ï¸', 'ðŸ“©', 'ðŸ“¨', 'ðŸ“§', 'ðŸ›–', 'ðŸ”‹', 'ðŸ”Œ', 'ðŸ“¼', 'ðŸ“¹', 'ðŸ“¼', 'ðŸ“ ', 'ðŸ“Ÿ', 'ðŸ“»', 'ðŸ“¼', 'ðŸ“¼', 'ðŸ§¾', 'ðŸ“ƒ', 'ðŸ“„', 'ðŸ“‘', 'ðŸ“›', 'ðŸº', 'ðŸš†', 'ðŸšƒ', 'ðŸš„', 'ðŸš…', 'ðŸª', 'ðŸšŒ', 'ðŸš', 'ðŸš‘', 'ðŸš’', 'ðŸš“', 'ðŸš”', 'ðŸš•', 'ðŸš–', 'ðŸš—', 'ðŸš˜', 'ðŸš™', 'ðŸšš', 'ðŸš›', 'ðŸšœ'
            ],
            circle: [
                'ðŸª', 'ðŸ©', 'ðŸ’¿', 'ðŸ“€', 'ðŸ•°ï¸', 'ðŸ§­', 'ðŸ›ž', 'ðŸ¥˜', 'ðŸ³', 'ðŸªž', 'â›”', 'ðŸ”ž', 'ðŸŸ¢', 'ðŸ”µ', 'ðŸŸ£', 'ðŸŸ¤', 'âš«', 'âšª', 'ðŸ”´', 'ðŸŸ ', 'ðŸŸ¡', 'ðŸ¥¯', 'ðŸ¥ž', 'ðŸ¥', 'ðŸ§', 'ðŸ¥§', 'ðŸ§†', 'ðŸ§‰', 'ðŸ¥¯', 'ðŸ•³ï¸', 'ðŸ’¿', 'ðŸ“€', 'ðŸ”˜', 'ðŸ”‡', 'ðŸ”ˆ', 'ðŸ”‰', 'ðŸ”Š', 'ðŸ””', 'ðŸ”•', 'ðŸš®', 'ðŸš°', 'â™¿', 'ðŸš¹', 'ðŸšº', 'ðŸš»', 'ðŸš¼', 'ðŸš¾', 'ðŸ›‚', 'ðŸ›ƒ', 'ðŸ›„', 'ðŸ›…', 'âš ï¸', 'ðŸš­', 'ðŸš¯', 'ðŸš±', 'ðŸš³', 'ðŸš«', 'ðŸ”ž', 'ðŸ“µ'
            ],
            triangle: [
                'ðŸ•', 'ðŸ™', 'âš ï¸', 'ðŸš©', 'ðŸ“', 'ðŸ¥ª', 'â›º', 'ðŸŽ„', 'ðŸ”º', 'ðŸ”»', 'ðŸ”ï¸', 'ðŸŒ‹', 'ðŸ«', 'ðŸª', 'ðŸ§€', 'ðŸ¦„', 'ðŸ¤•', 'ðŸ‘º', 'ðŸŽ‹', 'ðŸŽ', 'ðŸª', 'ðŸ‘™', 'ðŸ‘™', 'ðŸ¸', 'ðŸ¹', 'ðŸ–ï¸', 'ðŸ—ï¸', 'ðŸ—¼', 'â›µ', 'ðŸ›¥ï¸', 'ðŸš¤', 'ðŸ›³ï¸', 'â›´ï¸', 'ðŸš¢', 'ðŸŽ¢', 'ðŸ°', 'ðŸ¯', 'ðŸŸï¸', 'ðŸ—½', 'ðŸ ', 'ðŸ¡', 'ðŸšï¸'
            ],
            sphere: [
                'âš½', 'ðŸ€', 'âš¾', 'ðŸ¥Ž', 'ðŸŽ¾', 'ðŸ', 'ðŸŽ±', 'ðŸ”®', 'ðŸ§¶', 'ðŸŠ', 'ðŸŽ', 'ðŸ‘', 'ðŸ’', 'ðŸ…', 'ðŸŒ', 'ðŸŒŽ', 'ðŸŒ', 'ðŸŒ‘', 'ðŸŒ•', 'ðŸŽˆ', 'ðŸ’£', 'ðŸ«', 'ðŸ‡', 'ðŸˆ', 'ðŸ‰', 'ðŸ¥', 'ðŸ¥¥', 'ðŸ¥­', 'ðŸ¥”', 'ðŸ†', 'ðŸ§„', 'ðŸ§…', 'ðŸ¥š', 'ðŸ”', 'ðŸ¥š', 'ðŸ§‰', 'ðŸ¹', 'ðŸª', 'ðŸŒš', 'ðŸŒ›', 'ðŸŒœ', 'ðŸŒ', 'ðŸŒž', 'ðŸŒ', 'ðŸŽ‘', 'ðŸŽ'
            ],
            cone: [
                'ðŸ¦', 'ðŸŽ‰', 'ðŸ¥•', 'ðŸ“£', 'ðŸ”¦', 'ðŸ—¼', 'ðŸŒ‹', 'ðŸŒ½', 'ðŸ§', 'ðŸ¸', 'ðŸ¹', 'ðŸ¦—', 'ðŸš€', 'ðŸšœ', 'ðŸ¦¿', 'ðŸ‘ƒ', 'ðŸ‘‚', 'ðŸ¦»', 'ðŸ¦¶', 'ðŸ¦µ', 'ðŸ¦¾', 'ðŸ¤', 'âœï¸', 'ðŸ‘', 'ðŸ™', 'ðŸº', 'âš±ï¸', 'ðŸ’ˆ', 'ðŸ§¬', 'ðŸ”­', 'ðŸ”¬', 'ðŸ•¯ï¸', 'ðŸ§¨', 'ðŸŒ‚', 'â˜‚ï¸', 'ðŸŽ±', 'ðŸŽ³', 'â›³', 'ðŸŒï¸', 'ðŸ„', 'ðŸŠ', 'ðŸ¤½', 'ðŸš£', 'ðŸ§—', 'ðŸšµ', 'ðŸš´'
            ],
            cube: [
                'ðŸ§Š', 'ðŸ“¦', 'ðŸŽ²', 'ðŸŽ', 'ðŸ•‹', 'ðŸ±', 'ðŸ§ˆ', 'ðŸ§Š', 'ðŸ§±', 'ðŸ«', 'ðŸ¨', 'ðŸ¦', 'ðŸ¥', 'ðŸ¤', 'ðŸ£', 'ðŸ¢', 'ðŸ¬', 'ðŸ­', 'ðŸ¯', 'ðŸ°', 'ðŸ’’', 'ðŸ—¼', 'ðŸ—½', 'â›ª', 'ðŸ•Œ', 'ðŸ›•', 'ðŸ•', 'â›©ï¸', 'ðŸ•‹', 'â›²', 'â›º', 'ðŸŒ', 'ðŸŒƒ', 'ðŸ™ï¸', 'ðŸŒ„', 'ðŸŒ…', 'ðŸŒ†', 'ðŸŒ‡', 'ðŸŒ‰'
            ],
            cylinder: [
                'ðŸ¥«', 'ðŸ›¢ï¸', 'ðŸ”‹', 'ðŸ•¯ï¸', 'ðŸ¥¤', 'ðŸº', 'ðŸ»', 'ðŸ¥¡', 'ðŸ’„', 'ðŸ’ˆ', 'ðŸªµ', 'ðŸ—žï¸', 'ðŸŒ¯', 'ðŸ’Š', 'ðŸ—‘ï¸', 'ðŸ§¯', 'ðŸŽ»', 'ðŸ¥', 'ðŸ¥¢', 'ðŸ¼', 'ðŸ¥›', 'â˜•', 'ðŸµ', 'ðŸ¶', 'ðŸ¾', 'ðŸ·', 'ðŸ¸', 'ðŸ¹', 'ðŸº', 'ðŸ»', 'ðŸ¥‚', 'ðŸ¥ƒ', 'ðŸ¥¤', 'ðŸ§ƒ', 'ðŸ§‰', 'ðŸ§‚', 'ðŸ¥«', 'ðŸ—‘ï¸', 'ðŸ›¢ï¸', 'ðŸ’ˆ', 'ðŸ”­', 'ðŸ”¬', 'ðŸ§¨', 'ðŸ’£'
            ]
        };

        let hiddenObjects = [];
        let foundCounts = {};
        let targetCounts = {};
        let activeDrag = null; // { el, obj, startX, startY, initialLeft, initialTop }

        // Audio
        const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            if (audioCtx.state === 'suspended') audioCtx.resume();
            const osc = audioCtx.createOscillator();
            const gainNode = audioCtx.createGain();
            osc.connect(gainNode);
            gainNode.connect(audioCtx.destination);

            const now = audioCtx.currentTime;
            if (type === 'pop') {
                osc.frequency.setValueAtTime(400, now);
                osc.frequency.exponentialRampToValueAtTime(800, now + 0.1);
                gainNode.gain.setValueAtTime(0.5, now);
                gainNode.gain.exponentialRampToValueAtTime(0.01, now + 0.1);
                osc.start();
                osc.stop(now + 0.1);
            } else if (type === 'tada') {
                [523.25, 659.25, 783.99, 1046.50].forEach((freq, i) => {
                    const o = audioCtx.createOscillator();
                    const g = audioCtx.createGain();
                    o.connect(g);
                    g.connect(audioCtx.destination);
                    o.frequency.value = freq;
                    g.gain.setValueAtTime(0.3, now + i * 0.1);
                    g.gain.linearRampToValueAtTime(0, now + i * 0.1 + 0.4);
                    o.start(now + i * 0.1);
                    o.stop(now + i * 0.1 + 0.4);
                });
            } else if (type === 'oops') {
                osc.frequency.setValueAtTime(200, now);
                osc.frequency.linearRampToValueAtTime(100, now + 0.2);
                gainNode.gain.setValueAtTime(0.5, now);
                gainNode.gain.linearRampToValueAtTime(0, now + 0.2);
                osc.type = 'sawtooth';
                osc.start();
                osc.stop(now + 0.2);
            }
        }

        // --- Init ---
        function initGame() {
            targetCounts = {};
            foundCounts = {};
            hiddenObjects = [];
            let missionText = [];

            SHAPE_TYPES.forEach(type => {
                const count = Math.floor(Math.random() * 4) + 2;
                targetCounts[type.id] = count;
                foundCounts[type.id] = 0;
                missionText.push(`${count} ${type.emoji}`);

                for (let i = 0; i < count; i++) {
                    // Pick a random variant from the pool
                    const variants = SHAPE_VARIANTS[type.id];
                    const randomEmoji = variants[Math.floor(Math.random() * variants.length)];

                    hiddenObjects.push({
                        uniqueId: `${type.id}-${i}`,
                        type: type.id,
                        emoji: randomEmoji, // USE THE VARIANT, NOT THE BASE EMOJI
                        top: Math.random() * 85 + 5,
                        left: Math.random() * 85 + 5,
                        found: false
                    });
                }
            });

            document.getElementById('target-display').textContent = 'Mission: Find ' + missionText.join(', ');
            renderScene();
            renderTallyTable();
            document.getElementById('win-modal').classList.remove('visible');
        }

        // --- Rendering ---
        function renderScene() {
            const container = document.getElementById('zone-scene');
            container.innerHTML = '';

            hiddenObjects.forEach(obj => {
                if (obj.found) return;

                const el = document.createElement('div');
                el.className = 'shape-item';
                el.textContent = obj.emoji;
                el.style.top = obj.top + '%';
                el.style.left = obj.left + '%';
                el.style.touchAction = 'none'; // Critical for dragging

                // DATA attribute for easier matching
                el.dataset.type = obj.type;

                // Pointer Events for Dragging
                el.onpointerdown = (e) => startDrag(e, obj, el);

                container.appendChild(el);
            });
        }

        function renderTallyTable() {
            const tbody = document.getElementById('tally-body');
            tbody.innerHTML = '';

            SHAPE_TYPES.forEach(type => {
                const tr = document.createElement('tr');
                tr.dataset.targetType = type.id; // Drop Target Identity

                const tdShape = document.createElement('td');
                tdShape.textContent = `${type.emoji} ${type.name}`;
                tr.appendChild(tdShape);

                const tdTally = document.createElement('td');
                tdTally.appendChild(drawTally(foundCounts[type.id]));
                tr.appendChild(tdTally);

                const tdTotal = document.createElement('td');
                tdTotal.textContent = foundCounts[type.id];
                tr.appendChild(tdTotal);

                tbody.appendChild(tr);
            });
        }

        function drawTally(count) {
            const container = document.createElement('div');
            container.className = 'tally-marks';
            const groups = Math.floor(count / 5);
            const remainder = count % 5;
            for (let i = 0; i < groups; i++) {
                container.appendChild(createTallyGroup(5));
            }
            if (remainder > 0) {
                container.appendChild(createTallyGroup(remainder));
            }
            return container;
        }

        function createTallyGroup(num) {
            const group = document.createElement('div');
            group.className = 'tally-group';
            for (let i = 1; i <= num; i++) {
                const line = document.createElement('div');
                line.className = `tally-line line-${i}`;
                group.appendChild(line);
            }
            return group;
        }

        // --- Drag & Drop Logic ---
        function startDrag(e, obj, el) {
            if (obj.found) return;
            e.preventDefault();
            el.setPointerCapture(e.pointerId);

            activeDrag = {
                el: el,
                obj: obj,
                startX: e.clientX,
                startY: e.clientY,
                // Store initial position for snap-back
                initialLeft: el.style.left,
                initialTop: el.style.top,
                // Create a transform offset
                currentX: 0,
                currentY: 0
            };

            el.style.zIndex = 1000;
            el.style.transition = 'none';
            el.style.cursor = 'grabbing';
            el.style.transform = `scale(1.2)`;

            el.onpointermove = (ev) => onDrag(ev);
            el.onpointerup = (ev) => stopDrag(ev);
        }

        function onDrag(e) {
            if (!activeDrag) return;
            e.preventDefault();

            const dx = e.clientX - activeDrag.startX;
            const dy = e.clientY - activeDrag.startY;

            activeDrag.currentX = dx;
            activeDrag.currentY = dy;

            // Move using transform
            activeDrag.el.style.transform = `translate(${dx}px, ${dy}px) scale(1.2)`;
        }

        function stopDrag(e) {
            if (!activeDrag) return;
            const { el, obj } = activeDrag;

            el.releasePointerCapture(e.pointerId);
            el.onpointermove = null;
            el.onpointerup = null;
            el.style.cursor = 'pointer';

            // HIT TESTING
            // We need to check if the cursor (or center of element) is over a valid tr[data-target-type]
            // elementFromPoint uses clientX/Y
            const hitElements = document.elementsFromPoint(e.clientX, e.clientY);
            // Search for a Row with correct target type
            const targetRow = hitElements.find(item => {
                const row = item.closest('tr');
                return row && row.dataset.targetType === obj.type;
            });

            if (targetRow) {
                // SUCCESS
                successDrop(obj, el);
            } else {
                // FAIL - Snap back
                failDrop(el);
            }

            activeDrag = null;
        }

        function successDrop(obj, el) {
            playSound('pop');

            // Visual animate into "nothingness" (implies put in box)
            el.style.transition = 'transform 0.3s, opacity 0.3s';
            el.style.transform = `translate(${activeDrag.currentX}px, ${activeDrag.currentY}px) scale(0)`;
            el.style.opacity = '0';

            // Delay Update Logic slightly
            setTimeout(() => {
                obj.found = true;
                foundCounts[obj.type]++;
                renderTallyTable();
                checkWinCondition();
                el.remove(); // Remove from DOM entirely
            }, 300);
        }

        function failDrop(el) {
            playSound('oops');
            // Snap back
            el.style.transition = 'transform 0.3s';
            el.style.transform = 'translate(0, 0) scale(1)';
            el.style.zIndex = '';
        }

        // --- Win Logic ---
        function checkWinCondition() {
            let allFound = true;
            for (const type of SHAPE_TYPES) {
                if (foundCounts[type.id] < targetCounts[type.id]) {
                    allFound = false;
                    break;
                }
            }

            if (allFound) {
                setTimeout(() => {
                    playSound('tada');
                    confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
                    document.getElementById('win-modal').classList.add('visible');
                }, 500);
            }
        }

        function resetGame() {
            initGame();
        }

        document.getElementById('reset-btn').addEventListener('click', resetGame);
        initGame();

    </script>
</body>

</html>